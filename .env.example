# ======================================================
# Fazumi â€” Phase 5 (Production-hardened defaults)
# ======================================================

# ----------------------
# Safety default
# ----------------------
# MUST remain true until you personally verify:
# - real WhatsApp summaries are sent
# - paywall works
# - template-only behavior works outside 24h
DRY_RUN=true

# ----------------------
# Runtime / hosting
# ----------------------
# Cloud hosts (Render/Cloud Run) provide PORT automatically.
PORT=3000
TZ=Asia/Qatar
FAZUMI_TZ=Asia/Qatar

# ----------------------
# Supabase (REQUIRED)
# ----------------------
SUPABASE_URL=https://REPLACE_ME.supabase.co
SUPABASE_SERVICE_ROLE_KEY=REPLACE_ME

# ----------------------
# OpenAI (worker only)
# ----------------------
OPENAI_API_KEY=REPLACE_ME
OPENAI_PROJECT_ID=proj_REPLACE_ME

# Use the model your worker expects
OPENAI_MODEL=gpt-4o-mini
OPENAI_TEMPERATURE=0.2

# Cost / safety controls
OPENAI_MAX_INPUT_CHARS=6000
OPENAI_MAX_OUTPUT_TOKENS=450
OPENAI_CONCURRENCY=1
OPENAI_MAX_RETRIES=4

# WhatsApp output cap
WHATSAPP_MAX_OUTPUT_CHARS=1800

# ----------------------
# WhatsApp (360dialog)
# ----------------------
# 360dialog base URL (docs use waba-v2.360dialog.io)
D360_BASE_URL=https://waba-v2.360dialog.io
D360_API_KEY=REPLACE_ME

# ----------------------
# 24-hour customer service window + templates
# ----------------------
WHATSAPP_WINDOW_HOURS=24

# Template MUST be approved & ACTIVE in WhatsApp Manager / 360dialog
HELLO_TEMPLATE_NAME=hello_fazumi
D360_TEMPLATE_LANG=en

# ----------------------
# Encryption for text minimization (server stores encrypted text, not raw)
# ----------------------
# base64 of exactly 32 random bytes (AES-256-GCM key)
# Example generation (RUN LOCALLY, do not commit the output):
# node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
FAZUMI_TEXT_ENC_KEY_B64=REPLACE_ME

# ----------------------
# Lemon Squeezy
# ----------------------
# Checkout link you send to users
LEMON_CHECKOUT_URL=https://REPLACE_ME

# Webhook signature verification secret (REQUIRED if using Lemon webhooks)
LEMON_SIGNING_SECRET=REPLACE_ME

# ----------------------
# ZIP Chat Export (R3/R4)
# ----------------------
# Hard caps to prevent huge zip bombs / runaway memory.
ZIP_MAX_BYTES=6000000
ZIP_MAX_TEXT_CHARS=1200000

# If true, Fazumi will accept only .zip for "chat history analysis".
ZIP_ONLY_CHAT_ANALYSIS=true

# ----------------------
# Debug / ops (safe defaults)
# ----------------------
# NEVER enable in production unless debugging
DEBUG_WEBHOOKS=0
DEBUG_META_KEYS=0
DEBUG_WEBHOOKS_SAMPLE_KEYS_ONLY=1
