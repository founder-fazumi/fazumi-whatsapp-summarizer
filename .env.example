# ======================================================
# Fazumi — Phase 5 (Production-hardened defaults)
# ======================================================
# IMPORTANT:
# - This file is for LOCAL DEV only.
# - In PRODUCTION (Cloud Run), set these via Cloud Run "Variables & Secrets".
# - Never commit real secrets.

# ----------------------
# Safety default
# ----------------------
# Keep true until you personally verify:
# - WhatsApp replies send successfully
# - paywall works
# - free usage decrements ONLY after successful send
DRY_RUN=true

# ----------------------
# Runtime / hosting
# ----------------------
# WEBHOOK SERVICE only (src/server.js). Worker pool must NOT depend on PORT.
PORT=8080

# Linux/Node process timezone (affects Date() defaults)
TZ=Asia/Qatar

# Fazumi timezone for all date grounding rules (app-level)
FAZUMI_TZ=Asia/Qatar

# ----------------------
# Supabase (REQUIRED: service + worker)
# ----------------------
# Use your project URL from Supabase settings.
SUPABASE_URL=https://YOUR_PROJECT_REF.supabase.co

# MUST be server-side secret / service role key (NEVER expose client-side).
# In Supabase dashboard: Settings → API → service_role key (or sb_secret_...).
SUPABASE_SERVICE_ROLE_KEY=REPLACE_ME

# ----------------------
# WhatsApp (360dialog) (REQUIRED: service + worker)
# ----------------------
# 360dialog base URL is typically waba-v2.360dialog.io for production.
D360_BASE_URL=https://waba-v2.360dialog.io

# 360dialog API key (server-side)
D360_API_KEY=REPLACE_ME

# ----------------------
# 24-hour customer service window + templates (future proactive use)
# ----------------------
WHATSAPP_WINDOW_HOURS=24
HELLO_TEMPLATE_NAME=hello_fazumi
D360_TEMPLATE_LANG=en

# ----------------------
# OpenAI (WORKER ONLY)
# ----------------------
OPENAI_API_KEY=REPLACE_ME

# OPTIONAL (only if you use it in your code). Safe to leave blank if not used.
OPENAI_PROJECT_ID=

# Recommended MVP model (adjust if you want)
OPENAI_MODEL=gpt-4o-mini
OPENAI_TEMPERATURE=0.2

OPENAI_MAX_INPUT_CHARS=6000
OPENAI_MAX_OUTPUT_TOKENS=450
OPENAI_CONCURRENCY=1
OPENAI_MAX_RETRIES=4

# WhatsApp output cap (prompt/worker should respect this)
WHATSAPP_MAX_OUTPUT_CHARS=1800

# Burst batching (worker inbound text debounce)
BATCH_INITIAL_WAIT_MS=1800
BATCH_MAX_WINDOW_MS=12000
BATCH_QUIET_MS=2000

# ----------------------
# Encryption for text minimization (SERVICE encrypts; WORKER decrypts)
# ----------------------
# base64 of exactly 32 random bytes (AES-256-GCM key)
FAZUMI_TEXT_ENC_KEY_B64=MDEyMzQ1Njc4OWFiY2RlZjAxMjM0NTY3ODlhYmNkZWY=

# ----------------------
# Legal links (shown in first-time notice)
# ----------------------
# DO NOT invent links in production notices.
# If you don’t have pages yet, leave blank and your code should show "coming soon".
TERMS_LINK=
PRIVACY_LINK=

# ----------------------
# Lemon Squeezy (SERVICE webhook + worker paywall messages)
# ----------------------
LEMON_CHECKOUT_URL=https://REPLACE_ME

# SERVICE webhook ONLY (keep server-side; never log it; preserve raw-body verification)
LEMON_SIGNING_SECRET=REPLACE_ME

# ----------------------
# Debug / ops (safe defaults)
# ----------------------
DEBUG_WEBHOOKS=0
DEBUG_META_KEYS=0
DEBUG_WEBHOOKS_SAMPLE_KEYS_ONLY=1

# Worker pool health gate (webhook only)
# If false: webhook will ACK but skip enqueueing summary work (no "busy" replies).
WORKER_POOL_HEALTHY=true
